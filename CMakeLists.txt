cmake_minimum_required(VERSION 3.15)

FIND_PACKAGE(ZLIB QUIET)
find_package(OpenSSL QUIET)

add_library(HttpLib STATIC httplib.cc httplib.h)
target_include_directories(HttpLib PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})
#target_compile_definitions(HttpLib PUBLIC CPPHTTPLIB_USE_POLL)
if(WIN32)
  target_link_libraries(HttpLib ws2_32)
endif()

if(ZLIB_FOUND)
	message(STATUS "Build HttpLib with ZLIB")
	target_compile_definitions(HttpLib PUBLIC CPPHTTPLIB_ZLIB_SUPPORT )
	target_link_libraries(HttpLib ZLIB::ZLIB)
else()
	message(STATUS "Build HttpLib without ZLIB")
endif()

if (OpenSSL_FOUND)
	message(STATUS "Build HttpLib with OpenSSL")
	target_compile_definitions(HttpLib PUBLIC CPPHTTPLIB_OPENSSL_SUPPORT )
	target_link_libraries(HttpLib OpenSSL::SSL OpenSSL::Crypto)
	if(WIN32)
		target_link_libraries(HttpLib Crypt32)
	endif()
else()
	message(STATUS "Build HttpLib without OpenSSL")
endif()